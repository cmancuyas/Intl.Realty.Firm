@using Intl.Realty.Firm.Models.Models.ViewModel.DocumentTypeAssignmentVM
@model List<DocumentTypeAssignmentViewModel>

<div>
    <div class="row">
        <div class="col-md-12 d-flex justify-content-md-between align-items-center">
            <h1 class="text-blue mb-0">Document Types Assignment</h1>
            <div class="d-flex gap-4">
                <button id="btnDeleteDocumentTypeAssignment" class="btn btn-danger d-none align-items-center" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal"><i data-feather="x" class="w-15px h-auto me-1"></i>Delete</button>
                <a asp-action="Create"
                   class="btn btn-primary d-flex align-items-center">
                    <i data-feather="plus" class="w-15px h-auto me-1"></i>Create New
                </a>
            </div>
        </div>
    </div>
    <form method="post" asp-action="DeleteMultiple" class="pt-4">
        <table id="documentTypeAssignmentTable" class="data-table table table-hover w-100">
            <thead>
                <tr>
                    <th class="text-center w-5">
                        <input type="checkbox" class="column-checkbox" data-toggle="tooltip" data-bs-placement="left" title="Select all">
                    </th>
                    <th>
                        Id
                    </th>
                    <th>
                        Transaction Type
                    </th>
                    <th>
                        Document Type
                    </th>

                    <th>
                        Action
                    </th>
                </tr>
            </thead>
            <tbody>

                @{
                    var count = 0;
                }
                @foreach (var item in Model)
                {
                    count++;
                    <tr data-documentType-id="@item.Id">
                        <td class="text-center align-middle"> <input type="checkbox" class="row-checkbox" name="ids" value="@item.Id" /></td>
                        <td class="align-middle">
                            @{
                                @count.ToString()
                            }
                        </td>
                        <td class="align-middle">
                            @Html.DisplayFor(modelItem => @item.TransactionType.Name)
                        </td>
                        <td class="align-middle">
                            @Html.DisplayFor(modelItem => @item.DocumentType.Name)
                        </td>

                        <td class="align-middle">
                            <a asp-action="Edit" asp-route-id="@item.Id" style="text-decoration: none;">
                                <span class="table-control-btn pe-3" title="edit" data-position-id="@item.Id">
                                    <i data-feather="edit" class="data-feather-20"></i>
                                    Edit
                                </span>
                            </a>
                            <a href="#"
                               type="button"
                               data-bs-toggle="modal"
                            @* data-bs-target="#deletePositionModal" *@
                               onclick="OpenDeleteModal(@item.Id)"
                               style="text-decoration: none;">
                                <span class="table-control-btn icon-red" title="delete" data-position-id="@item.Id">
                                    <i data-feather="trash-2" class="data-feather-20"></i>
                                    Delete
                                </span>
                            </a>
                        </td>
                    </tr>
                }


            </tbody>
        </table>

    </form>
</div>

<script>
    $(document).ready(function () {
        $('.data-table').DataTable({
            columnDefs: [
                { targets: [0], orderable: false }
            ],
            order: [[1, 'asc']]
        });

        $('#documentTypeAssignmentTable').on('click', 'tbody tr', function (event) {
            // Check if the clicked element is not the checkbox
            if (!$(event.target).is(':checkbox')) {
                var documentTypeId = $(this).data('documentType-id');
                window.location.href = '@Url.Action("Edit", "DocumentTypeAssignment")' + '?id=' + documentTypeId;
            }
        });

        $('.column-checkbox').change(function () {
            var isChecked = $(this).prop('checked');
            $('.row-checkbox').prop('checked', isChecked);
        });

        $('#documentTypeAssignmentTable').on('change', '.column-checkbox', function () {
            var isChecked = $(this).prop('checked');
            $('.row-checkbox').prop('checked', isChecked);

        });

        $('#documentTypeAssignmentTable').on('change', '.row-checkbox', function () {
            var isChecked = $(this).prop('checked');

            var allChecked = $('.row-checkbox').length === $('.row-checkbox:checked').length;
            $('.column-checkbox').prop('checked', allChecked);

        });

        $('#documentTypeAssignmentTable').on('change', '.row-checkbox, .column-checkbox', function () {
            var atLeastOneChecked = $('.row-checkbox:checked').length > 0;
            $('#btnDeleteDocumentTypeAssignment').toggleClass('d-none', !atLeastOneChecked);
            $('#btnDeleteDocumentTypeAssignment').toggleClass('d-flex', atLeastOneChecked);

            if ($(this).hasClass('column-checkbox')) {
                var isChecked = $(this).prop('checked');
                $('.row-checkbox').prop('checked', isChecked);
            }
        });

        $('.row-checkbox').change(function () {
            var allChecked = $('.row-checkbox').length === $('.row-checkbox:checked').length;
            $('.column-checkbox').prop('checked', allChecked);
        });

        if (getUrlParameter('deleteSuccess') === 'true') {
            toastr.success('Selection deleted successfully!', '', {
                timeOut: 10000,
                closeButton: true,
                onHidden: function () {
                    updateUrlParameter('deleteSuccess', '');
                }
            });
        }

        $('#btnConfirmDelete').click(function () {
            $('#deleteConfirmModal').modal('hide');
            window.location.href = window.location.href.split('?')[0] + '?deleteSuccess=true';
        });
    });

    $("#cancelBtn").click(function () {
        closeModal();
    });

    function OpenMultipleDeleteModal() {
        var selectedRows = getSelectedRows();
        var selectedIdsArray = getIdsFromSelectedRows(selectedRows);

        var allChecked = $('.row-checkbox').length === $('.row-checkbox:checked').length;
        $('.column-checkbox').prop('checked', allChecked);

        $('#documentTypeAssignmentDeleteMultipleModalContainer').load('/DocumentTypeAssignment/DeleteMultipleModal/', { ids: selectedIdsArray }, function () {
            $("#deleteConfirmModal").modal("show");
        });
    }

    function getIdsFromSelectedRows(selectedRows) {
        var ids = [];
        for (var i = 0; i < selectedRows.length; ++i)
            ids.push(selectedRows[i].value);
        return ids;
    }

    function OpenDeleteModal(id) {

        $('#documentTypeAssignmentDeleteModalContainer').load('/DocumentTypeAssignment/DeleteModal/' + id, function () {

            $("#deleteConfirmModal").modal("show");
        });
    }

</script>
